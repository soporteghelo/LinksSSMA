<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>AESA - Portal de Gestión (Preview)</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'aesa-blue': '#003366',
                        'aesa-red': '#E30613',
                        'aesa-dark': '#1a1a1a',
                        'aesa-gray': '#f4f4f4',
                        'aesa-text': '#333333',
                    },
                    fontFamily: {
                        'display': ['Inter', 'sans-serif'],
                        'condensed': ['Roboto Condensed', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .loader {
            border-top-color: #003366 !important;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }

        @keyframes spinner {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .carousel-fade {
            transition: opacity 1s ease-in-out;
            opacity: 1;
        }

        .carousel-hidden {
            opacity: 0;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-anim {
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        mark {
            background-color: #fef08a;
            color: #1a1a1a;
            padding: 0 2px;
            border-radius: 2px;
        }
    </style>
</head>

<body class="bg-gray-50 text-aesa-text font-display m-0 p-0 min-h-screen flex flex-col">

    <!-- Loading Screen -->
    <div id="loadingOverlay"
        class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
        <h2 class="text-center text-aesa-dark text-xl font-semibold">Cargando Portal...</h2>
        <p class="w-1/3 text-center text-gray-500 text-sm mt-2">Obteniendo documentos más recientes</p>
    </div>

    <header
        class="bg-white text-aesa-dark shadow-sm border-b-4 border-aesa-blue sticky top-0 z-50 transition-shadow duration-300"
        id="mainHeader">
        <div
            class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 md:h-20 flex flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-3 md:gap-4 cursor-pointer shrink-0 group select-none"
                onclick="showDashboard()">
                <img src="https://www.aesa.com.pe/wp-content/uploads/2022/08/cropped-LogoAesa-1024x348.png" alt="AESA"
                    class="h-8 md:h-12 w-auto object-contain transition-transform duration-300 group-hover:scale-105">
                <div class="w-px h-8 md:h-12 bg-gray-200 group-hover:bg-aesa-blue/50 transition-colors duration-300">
                </div>
                <div class="flex flex-col justify-center">
                    <span
                        class="text-[10px] md:text-xs font-semibold text-gray-400 uppercase tracking-[0.2em] leading-tight group-hover:text-aesa-blue transition-colors duration-300">Portal
                        de</span>
                    <span
                        class="text-sm md:text-xl font-bold font-condensed text-aesa-dark leading-none uppercase tracking-wide group-hover:text-black transition-colors duration-300">Gestión
                        Documental</span>
                </div>
            </div>
            <div class="flex items-center justify-end flex-1">
                <button onclick="openSearch()"
                    class="bg-gray-100 hover:bg-gray-200 text-aesa-dark p-2 rounded-full transition-colors flex items-center justify-center shrink-0">
                    <span class="material-icons">search</span>
                </button>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 w-full space-y-6">
        <section id="heroSection"
            class="hidden relative rounded-xl overflow-hidden shadow-xl bg-aesa-dark group h-48 md:h-64">
            <div id="carouselContainer" class="w-full h-full relative"></div>
            <div id="carouselIndicators" class="absolute bottom-4 right-4 flex gap-2 z-30"></div>
        </section>

        <div id="dashboardView" class="hidden">
            <div class="flex items-end gap-2 mb-4">
                <h2
                    class="text-xl font-bold font-condensed text-aesa-dark uppercase tracking-wide border-l-4 border-aesa-blue pl-3">
                    Explorar por Categorías</h2>
            </div>
            <div id="categoryButtonsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
        </div>

        <div id="detailView" class="hidden">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="showDashboard()"
                    class="flex items-center gap-1 text-gray-500 hover:text-aesa-blue transition-colors font-medium text-sm bg-white px-3 py-1.5 rounded-md border border-gray-300 hover:border-aesa-blue shadow-sm">
                    <span class="material-icons text-sm">arrow_back</span> Volver
                </button>
                <h2 id="currentCategoryTitle"
                    class="text-2xl font-bold font-condensed text-aesa-dark uppercase tracking-wide"></h2>
            </div>
            <div id="cardsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
        </div>

        <div id="emptyState" class="hidden flex flex-col items-center justify-center py-20">
            <span class="material-icons text-6xl text-gray-300 mb-4 text-aesa-blue">folder_off</span>
            <h3 class="text-xl font-bold text-gray-600">No se encontraron documentos</h3>
            <p class="text-gray-500">Intenta con otros términos de búsqueda.</p>
            <button onclick="showDashboard()" class="mt-4 text-aesa-blue font-bold text-sm hover:underline">Ver todas
                las categorías</button>
        </div>
    </main>

    <div id="modal"
        class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[60] hidden transition-opacity duration-300 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 overflow-hidden relative transform transition-transform duration-300 scale-95"
            id="modalContainer">
            <div class="bg-aesa-blue px-6 py-4 flex items-center gap-4">
                <h3 id="modalTitle" class="text-white text-xl font-bold font-condensed flex-grow leading-tight">Título
                    del Documento</h3>
                <a id="modalLink" href="#" target="_blank"
                    class="hidden items-center gap-1.5 text-aesa-blue bg-white hover:bg-gray-50 px-3 py-1 rounded-full text-[10px] font-bold transition-all duration-300 shadow-md hover:shadow-xl hover:scale-105 uppercase tracking-wide whitespace-nowrap group text-center">
                    <span class="material-icons text-xs group-hover:rotate-12 transition-transform">visibility</span>
                    CLICK AQUI<br>PARA VER
                </a>
                <button id="closeModal"
                    class="text-white hover:bg-black/20 rounded-full p-1 transition-colors flex items-center justify-center shrink-0">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="flex flex-col max-h-[85vh]">
                <div class="overflow-y-auto">
                    <img id="modalImage" src="" alt="Imagen detalle" class="w-full h-48 sm:h-64 object-cover hidden">
                    <div class="p-6 space-y-4">
                        <div
                            class="flex items-center gap-2 text-gray-400 text-xs font-medium uppercase tracking-wider mb-2">
                            <span class="material-icons text-sm">calendar_today</span>
                            <span id="modalDate">...</span>
                        </div>
                        <div>
                            <h4 class="text-sm font-bold text-aesa-dark uppercase tracking-wide mb-2">Descripción</h4>
                            <div class="max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                                <p id="modalDescription" class="text-gray-600 text-sm leading-relaxed"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="searchOverlay"
        class="fixed inset-0 bg-aesa-dark/95 z-[70] hidden transition-opacity duration-300 backdrop-blur-sm flex flex-col pt-6 px-4">
        <div class="w-full max-w-4xl mx-auto flex flex-col h-full">
            <div class="flex items-center gap-4 mb-8 shrink-0">
                <div class="relative flex-grow">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-4">
                        <span class="material-icons text-gray-400 text-3xl">search</span>
                    </span>
                    <input type="text" id="searchInput" placeholder="Buscar documento..."
                        class="w-full pl-14 pr-6 py-4 bg-white/10 border-2 border-white/20 text-white placeholder-gray-400 rounded-2xl focus:outline-none focus:border-aesa-blue focus:bg-white/20 text-xl transition-all shadow-2xl backdrop-blur-md">
                </div>
                <button onclick="closeSearch()"
                    class="text-white/70 hover:text-white rounded-full p-2 transition-colors shrink-0 bg-white/10 hover:bg-white/20">
                    <span class="material-icons text-3xl">close</span>
                </button>
            </div>
            <div id="searchResultsOverlay"
                class="flex-grow overflow-y-auto custom-scrollbar pb-10 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 content-start">
                <div class="col-span-full text-center text-gray-500 mt-20">
                    <span class="material-icons text-6xl mb-4 opacity-50 text-aesa-blue">manage_search</span>
                    <p class="text-xl">Escribe para comenzar a buscar...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- MOCK DATA FOR PREVIEW ---
        const MOCK_DATA = [
            { TITULO: "Protocolo de Seguridad en Socavón", CATEGORIA: "Comunicado", DESCRIPCION_CORTA: "Actualización de medidas de emergencia para el nivel 4.", LINK_FOTO: "https://images.unsplash.com/photo-1541963463532-d68292c34b19?auto=format&fit=crop&q=80&w=1200", FECHA: "2024-10-25", LINK_INFORMACION: "https://example.com/pdf", ORDEN: 1 },
            { TITULO: "Mantenimiento Preventivo Jumbos", CATEGORIA: "Mantenimiento", DESCRIPCION_CORTA: "Guía de revisión técnica diaria.", LINK_FOTO: "", FECHA: "2024-10-20", LINK_INFORMACION: "", ORDEN: 1 },
            { TITULO: "PETS Excavación Convencional", CATEGORIA: "PETS", DESCRIPCION_CORTA: "Procedimiento estándar de excavación.", LINK_FOTO: "https://images.unsplash.com/photo-1586769852044-692d6e692453?auto=format&fit=crop&q=80&w=400", FECHA: "2024-09-15", LINK_INFORMACION: "https://example.com/pets", ORDEN: 1 },
            { TITULO: "Estándar de EPP 2024", CATEGORIA: "Estándares", DESCRIPCION_CORTA: "Requerimientos mínimos de protección personal.", FECHA: "2024-08-01", ORDEN: 1 }
        ];

        const FALLBACK_IMAGE = "https://images.unsplash.com/photo-1518623489648-a173ef7824f3?auto=format&fit=crop&q=80&w=800";
        const CATEGORY_ICONS = { 'PETS': 'description', 'Estándares': 'rule', 'IPERC': 'warning_amber', 'Capacitación': 'school', 'Examen': 'quiz', 'Otros': 'folder' };

        let appData = [];
        let groupedData = {};
        let carouselInterval;
        let currentSlide = 0;
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('DOMContentLoaded', () => {
            // In preview mode, use mock data
            onDataSuccess(MOCK_DATA);

            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('modal').addEventListener('click', (e) => { if (e.target.id === 'modal') closeModal(); });
            document.getElementById('searchInput').addEventListener('input', handleSearch);
        });

        function onDataSuccess(data) {
            if (!data || data.length === 0) { showEmptyState(true); hideLoader(); return; }
            initApp(data);
        }

        function initApp(data) {
            appData = data;
            const comunicados = appData.filter(item => item.CATEGORIA === 'Comunicado').sort((a, b) => (Number(a.ORDEN) || 0) - (Number(b.ORDEN) || 0));
            const others = appData.filter(item => item.CATEGORIA !== 'Comunicado');
            groupedData = others.reduce((acc, item) => {
                const cat = item.CATEGORIA || 'Otros';
                if (!acc[cat]) acc[cat] = [];
                acc[cat].push(item);
                return acc;
            }, {});
            Object.keys(groupedData).forEach(cat => groupedData[cat].sort((a, b) => (Number(a.ORDEN) || 999) - (Number(b.ORDEN) || 999)));
            renderHero(comunicados);
            renderDashboard(groupedData);
            hideLoader();
        }

        function renderHero(items) {
            const container = document.getElementById('heroSection');
            const innerContainer = document.getElementById('carouselContainer');
            const indicators = document.getElementById('carouselIndicators');
            if (!items || items.length === 0) { container.classList.add('hidden'); return; }
            container.classList.remove('hidden');
            innerContainer.innerHTML = '';
            indicators.innerHTML = '';
            items.forEach((item, index) => {
                const isHidden = index === 0 ? '' : 'carousel-hidden opacity-0';
                const slide = document.createElement('div');
                slide.className = `absolute inset-0 w-full h-full transition-opacity duration-1000 ease-in-out ${isHidden}`;
                slide.dataset.index = index;
                slide.onclick = () => openModal(item);
                slide.innerHTML = `<div class="relative w-full h-full cursor-pointer"><div class="absolute inset-0 bg-gradient-to-r from-aesa-dark via-aesa-dark/80 to-transparent z-10"></div><img src="${item.LINK_FOTO || FALLBACK_IMAGE}" alt="Comunicado" class="w-full h-full object-cover opacity-60" onerror="this.src='${FALLBACK_IMAGE}'"><div class="absolute inset-0 z-20 flex flex-col justify-center px-6 md:px-12 max-w-4xl"><span class="inline-flex items-center gap-1.5 self-start px-2 py-0.5 rounded-full bg-aesa-blue text-white text-[10px] font-bold uppercase tracking-wider mb-2 shadow-sm animate-pulse"><span class="material-icons text-[10px]">campaign</span> Comunicado</span><h2 class="text-xl md:text-3xl font-bold text-white mb-2 leading-tight font-condensed line-clamp-1">${item.TITULO}</h2><p class="text-gray-300 text-xs md:text-sm line-clamp-2 max-w-2xl mb-3">${item.DESCRIPCION_CORTA}</p><button class="bg-white text-aesa-dark hover:bg-gray-100 font-bold py-1.5 px-4 rounded text-xs transition-all flex items-center gap-1 shadow-md self-start">LEER MÁS <span class="material-icons text-[10px]">arrow_forward</span></button></div></div>`;
                innerContainer.appendChild(slide);
                const dot = document.createElement('button');
                dot.className = `w-2 h-2 rounded-full transition-all duration-300 ${index === 0 ? 'bg-aesa-blue w-4' : 'bg-white/50 hover:bg-white'}`;
                dot.onclick = (e) => { e.stopPropagation(); goToSlide(index); };
                indicators.appendChild(dot);
            });
            if (items.length > 1) startCarousel(items.length);
        }

        function startCarousel(total) {
            if (carouselInterval) clearInterval(carouselInterval);
            carouselInterval = setInterval(() => { goToSlide((currentSlide + 1) % total); }, 5000);
        }

        function goToSlide(index) {
            const slides = document.querySelectorAll('#carouselContainer > div');
            const dots = document.querySelectorAll('#carouselIndicators button');
            if (!slides[currentSlide]) return;
            slides[currentSlide].classList.add('carousel-hidden', 'opacity-0');
            dots[currentSlide].className = 'w-2 h-2 rounded-full bg-white/50 hover:bg-white transition-all duration-300';
            currentSlide = index;
            slides[currentSlide].classList.remove('carousel-hidden', 'opacity-0');
            dots[currentSlide].className = 'w-4 h-2 rounded-full bg-aesa-blue transition-all duration-300';
        }

        function renderDashboard(groups) {
            const view = document.getElementById('dashboardView');
            view.classList.remove('hidden'); view.classList.add('fade-in');
            document.getElementById('detailView').classList.add('hidden');
            document.getElementById('emptyState').classList.add('hidden');
            const container = document.getElementById('categoryButtonsGrid');
            container.innerHTML = '';
            Object.keys(groups).sort().forEach((cat, index) => {
                const count = groups[cat].length;
                const icon = CATEGORY_ICONS[cat] || 'folder';
                const btn = document.createElement('div');
                btn.className = "bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-lg hover:border-aesa-blue transition-all duration-300 cursor-pointer group flex items-center justify-between card-anim";
                btn.style.animationDelay = `${index * 0.05}s`;
                btn.onclick = () => showCategoryDetail(cat);
                btn.innerHTML = `<div class="flex items-center gap-4"><div class="w-12 h-12 rounded-full bg-gray-50 flex items-center justify-center group-hover:bg-aesa-blue transition-colors duration-300"><span class="material-icons text-aesa-dark group-hover:text-white text-2xl transition-colors duration-300">${icon}</span></div><div><h3 class="font-bold text-lg text-aesa-dark font-condensed uppercase tracking-wide group-hover:text-aesa-blue transition-colors">${cat}</h3><p class="text-gray-500 text-xs">${count} Documentos</p></div></div><span class="material-icons text-gray-300 group-hover:text-aesa-blue group-hover:translate-x-1 transition-all">chevron_right</span>`;
                container.appendChild(btn);
            });
        }

        function showCategoryDetail(cat) {
            document.getElementById('dashboardView').classList.add('hidden');
            const view = document.getElementById('detailView'); view.classList.remove('hidden'); view.classList.add('fade-in');
            document.getElementById('currentCategoryTitle').textContent = cat;
            const grid = document.getElementById('cardsGrid'); grid.innerHTML = '';
            groupedData[cat].forEach((item, index) => {
                const card = createCard(item); card.classList.add('card-anim'); card.style.animationDelay = `${index * 0.05}s`;
                grid.appendChild(card);
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showDashboard() {
            document.getElementById('detailView').classList.add('hidden');
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('searchInput').value = '';
            const v = document.getElementById('dashboardView'); v.classList.remove('hidden'); v.classList.add('fade-in');
            renderDashboard(groupedData);
        }

        function createCard(item, highlightTerm = '') {
            const div = document.createElement('article');
            div.className = "bg-white rounded overflow-hidden shadow-sm hover:shadow-md transition-all duration-300 border border-gray-200 flex flex-col h-full card-hover cursor-pointer group card-item";
            div.onclick = () => openModal(item);
            const imgUrl = (item.LINK_FOTO && item.LINK_FOTO.toString().trim() !== "") ? item.LINK_FOTO : FALLBACK_IMAGE;
            let titleHtml = item.TITULO; let descHtml = item.DESCRIPCION_CORTA;
            if (highlightTerm) {
                const regex = new RegExp(`(${highlightTerm})`, 'gi');
                titleHtml = titleHtml.replace(regex, '<mark>$1</mark>'); descHtml = descHtml.replace(regex, '<mark>$1</mark>');
            }
            div.innerHTML = `<div class="h-28 overflow-hidden relative bg-gray-100"><img src="${imgUrl}" alt="${item.TITULO}" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-500" onerror="this.src='${FALLBACK_IMAGE}'"><div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300"></div></div><div class="p-3 flex flex-col flex-grow"><h3 class="text-sm font-bold font-condensed text-aesa-dark mb-1 leading-tight group-hover:text-aesa-blue transition-colors line-clamp-2">${titleHtml}</h3><p class="text-[11px] text-gray-500 line-clamp-2 mb-3 flex-grow leading-snug">${descHtml}</p><div class="mt-auto border-t border-gray-50 pt-2"><button class="text-[11px] font-bold text-white bg-aesa-blue hover:bg-blue-900 w-full py-1.5 rounded transition-colors uppercase tracking-wide opacity-90 hover:opacity-100 shadow-sm group-hover:shadow hover:translate-y-px">VER</button></div></div>`;
            return div;
        }

        function handleSearch(e) {
            const term = e.target.value.toLowerCase().trim();
            const resultsContainer = document.getElementById('searchResultsOverlay');
            if (term === '') { resultsContainer.innerHTML = `<div class="col-span-full text-center text-gray-500 mt-20"><span class="material-icons text-6xl mb-4 opacity-50">manage_search</span><p class="text-xl">Escribe para comenzar a buscar...</p></div>`; return; }
            resultsContainer.innerHTML = ''; let foundCount = 0;
            Object.values(groupedData).flat().forEach((item) => {
                if (item.TITULO.toLowerCase().includes(term) || item.DESCRIPCION_CORTA.toLowerCase().includes(term)) {
                    const card = createCard(item, term); card.onclick = () => { closeSearch(); openModal(item); };
                    card.classList.add('card-anim'); card.style.animationDelay = `${foundCount * 0.05}s`;
                    resultsContainer.appendChild(card); foundCount++;
                }
            });
            if (foundCount === 0) resultsContainer.innerHTML = `<div class="col-span-full text-center text-gray-500 mt-20"><span class="material-icons text-6xl mb-4 opacity-50">search_off</span><p class="text-xl">No se encontraron resultados</p></div>`;
        }

        function hideLoader() { const loader = document.getElementById('loadingOverlay'); loader.style.opacity = '0'; setTimeout(() => loader.classList.add('hidden'), 500); }

        function openModal(item) {
            const modal = document.getElementById('modal'); const cont = document.getElementById('modalContainer');
            document.getElementById('modalTitle').textContent = item.TITULO;
            document.getElementById('modalDescription').textContent = item.DESCRIPCION_CORTA || "Sin descripción.";
            document.getElementById('modalDate').textContent = item.FECHA || "N/A";
            const linkBtn = document.getElementById('modalLink');
            if (item.LINK_INFORMACION && item.LINK_INFORMACION !== "#") { linkBtn.classList.remove('hidden'); linkBtn.classList.add('flex'); linkBtn.href = item.LINK_INFORMACION; } else { linkBtn.classList.add('hidden', 'flex'); }
            const img = document.getElementById('modalImage'); img.src = item.LINK_FOTO || FALLBACK_IMAGE; img.classList.remove('hidden');
            modal.classList.remove('hidden'); setTimeout(() => cont.classList.remove('scale-95'), 10);
        }
        function closeModal() { const modal = document.getElementById('modal'); const cont = document.getElementById('modalContainer'); cont.classList.add('scale-95'); setTimeout(() => modal.classList.add('hidden'), 200); }
        function openSearch() { document.getElementById('searchOverlay').classList.remove('hidden'); setTimeout(() => document.getElementById('searchInput').focus(), 100); }
        function closeSearch() { document.getElementById('searchOverlay').classList.add('hidden'); }
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeSearch(); });
    </script>
</body>

</html>